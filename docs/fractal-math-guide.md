# **A Guide to Fractal Mathematics and Data Maps**

This document outlines the core mathematical principles and data maps generated by the `frxp.core.fractal_calcs` module, which contains the highly optimized `mandelbrot_numba` and `julia_numba` functions. It serves as a guide to understanding the data produced by these calculations.

## **1\. The Core Iteration**

Both the Mandelbrot and Julia sets are defined by a simple, iterative process on the complex plane. The central equation is:  
![equation](images/equation1.png)
Where:

* *Z* and *C* are complex numbers.  
* *n* is the iteration number, starting from 0.  
* *P* is the power to which the complex number *Z* is raised. In a standard Mandelbrot or Julia set, *P* = 2.

### **The Distinction Between Mandelbrot and Julia**

The difference between the two sets lies in which complex number is held constant and which is iterated.

* **Mandelbrot Set**: Each point (*x*,*y*) on the complex plane represents the constant value *C* = *x* + *yi*. The initial value is fixed at *Z*<sub>0</sub> ​= 0. The iteration determines if the orbit of *Z* for that specific *C* remains bounded.  

* **Julia Set**: A single, constant value for *C* is chosen for the entire image. Each point (*x*,*y*) on the complex plane represents the initial value *Z*<sub>0</sub> ​= *x* + *yi*. The iteration determines if the orbit of *Z* for that specific *Z*<sub>0</sub>​ remains bounded.

## **2\. Key Calculated Maps**

Our fractal functions compute a variety of data maps in a single pass. These maps provide different perspectives on the fractal, allowing for diverse and detailed visualizations. All maps are two-dimensional NumPy arrays where each element corresponds to a pixel in the final image.

### **Map Categories**

The generated maps can be divided into several logical categories:

* **Escape-Time Maps**: These maps are fundamental to all fractal rendering and are based on the number of iterations required for a point to "escape" a defined boundary.  

  * **iterations\_map**: Stores the exact number of iterations it took for the point's orbit to exceed the bailout radius. For points that never escape, the map stores the maximum number of iterations.  

  * **normalized\_iterations\_map**: A smoother version of the iterations\_map that applies a linear normalization to the iteration count, often with a "smoothing" algorithm to remove banding effects and produce a more continuous-looking image. This is a primary map for rendering the classic escape-time fractal.  

* **Distance Estimation Maps**: These maps provide a measure of how close a point is to the fractal boundary, allowing for high-resolution, continuous coloring.

  * **distance\_map**: For a point that escapes, this map contains a value proportional to the distance from that point to the boundary of the set. Values are smaller for points closer to the set.  

  * **min\_distance\_to\_trap\_map**: This map is generated when a "trap" is used. It records the minimum distance a point's orbit came to the defined trap (e.g., a line, a point, or a circle) during its iteration.  

* **Orbital and Final State Maps**: These maps record the state of a point's orbit at a specific time, offering insight into the chaotic behavior of the iteration.  

  * **magnitudes\_map**: Records the final magnitude of the complex number *Z* for each point that escapes.  

  * **initial\_angles\_map**: The angle (argument) of the initial point *Z*<sub>0</sub>​ in the complex plane.  

  * **final\_angles\_map**: The angle of the final complex number *Z* at the point of escape. This is a valuable map for creating swirling, psychedelic colorings. It is calculated using the `np.arctan2(imaginary_part, real_part)` function, which correctly handles all four quadrants and the cases where the real part is zero, returning an angle in radians from −π to \+π.  

  * **min\_distance\_iteration\_map**: In the presence of a trap, this map stores the iteration number at which the orbit was closest to the trap.  

  * **derivative\_bailout\_map**: Records the value of the derivative at the point of escape. This is a crucial value for a variety of advanced coloring techniques and visualizations of the fractal boundary.  

* **Component and Derivative Maps**: These maps store the real and imaginary components of the final complex numbers and their derivatives, providing granular data for custom visualizations and calculations.  

  * **final\_Z\_real\_map** and **final\_Z\_imag\_map**: The real and imaginary components of the final complex number *Z* at the time of escape or at the maximum number of iterations.  

  * **final\_derivative\_real\_map** and **final\_derivative\_imag\_map**: The real and imaginary components of the final derivative of the iteration function at the point of escape or at the maximum number of iterations.  

  * **bailout\_location\_real\_map** and **bailout\_location\_imag\_map**: The real and imaginary coordinates of the complex number *Z* at the exact iteration it exceeded the bailout radius.  

* **Fixed-Iteration Maps**: These maps capture a snapshot of the iteration at a specified fixed iteration, which is particularly useful for visualizing the "interior" of the fractal.  

  * **final\_Z\_real\_at\_fixed\_iteration\_map** and **final\_Z\_imag\_at\_fixed\_iteration\_map**: The real and imaginary components of the complex number *Z* after a specific number of fixed iterations.

## **3\. The Role of np.arctan2**

In both the `julia_numba` and `mandelbrot_numba functions`, the `np.arctan2` function is used to calculate the angle of a complex number, for example, for the `final_angles_map`. Its use is critical for mathematical correctness. Unlike `np.arctan(y/x)`, which is prone to division-by-zero errors and cannot distinguish between quadrants, `np.arctan2(y, x)` correctly returns the angle for any point (*x*,*y*) in the Cartesian plane. It's the standard for converting Cartesian coordinates to a true polar angle.